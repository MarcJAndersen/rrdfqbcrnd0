---
title: "Two dimensional representation of RDF data cube"
author: "PhuseSubTeamAnalysisResults@example.org"
date: "`r Sys.Date()`"
vignette: >
  %\VignetteIndexEntry{Two dimensional representation of RDF data cube}
  %\VignetteEngine{knitr::knitr}
  %\usepackage[utf8]{inputenc}
  %\SweaveUTF8
---

# Setup

First load the package.
```{r, eval=TRUE}
library(rrdfqbcrnd0)
```

# Loading DEMO data 

The DEMO data exists as a turtle file in the sample-rdf directory.

```{r, eval=TRUE}

dataCubeFile<- system.file("extdata/sample-rdf", "DC-DEMO-sample.ttl", package="rrdfqbcrnd0")
dataCubeFile<- system.file("extdata/sample-rdf", "DC-AE-sample.ttl", package="rrdfqbcrnd0")
store <- new.rdf()  # Initialize
cat("Loading ", dataCubeFile, "\n")
load.rdf(dataCubeFile, format="TURTLE", appendTo= store)
summarize.rdf(store)

dsdName<- GetDsdNameFromCube( store )
domainName<- GetDomainNameFromCube( store )
forsparqlprefix<- GetForSparqlPrefix( domainName )
```

View a specific observation. The observation is specified in the values part of the SPARQL query.

```{r, eval=TRUE}
cube.observations.rq<-  paste( forsparqlprefix,
'
select *
where { 
?s a qb:Observation ; 
?p ?o .
values (?s) {
(ds:obs029)
}
}
',
"\n"                               
)

cube.observations<- sparql.rdf(store, cube.observations.rq)
knitr::kable(cube.observations)

```


# Current - 06-may-2015

The following code is under development. It creates a HTML file
extdata/sample-cfg/test.html showing a two dimensional representation
of the table with drag and drop. The observations are stored as RDFa
in the HTML. Pending: including the rest of the cube into the
html. Consider if in each cell only the observation and measure should
be referenced and not all properties and objects for the observation.


The HTML includes green-turtle
(https://github.com/alexmilowski/green-turtle), jquery
(http://jquery.com/) and jqueryUI (http://jqueryui.com/).  In my setup
I store the project under packages, and can symlink to the files from the
extdata/sample-cfg directory.


    cd extdata/sample-cfg
    ln -s ~/packages/green-turtle/build/RDFa.min.1.4.0.js 
    ln -s ~/packages/green-turtle/build/RDFaProcessor.min.1.4.0.js 
    ln -s ~/packages/jquery-2.1.3.min/jquery-2.1.3.min.js .
    ln -s ~/packages/jquery-ui-1.11.3.custom .

The contents of the 
```{r, echo=TRUE}
cols.rq<- GetRownoColnoCellpartnoSparqlQuery( forsparqlprefix )
cols<- data.frame(sparql.rdf(store, cols.rq))
knitr::kable(cols)

```



```{r, echo=TRUE}

dimensions<- sparql.rdf(store, GetDimensionsSparqlQuery( forsparqlprefix ) )
attributesDf<- sparql.rdf(store, GetAttributesSparqlQuery( forsparqlprefix ))

# For ae table
rowdim<- c("crnd-attribute:rowno", "crnd-dimension:aesoc", "crnd-dimension:aedecod" )
coldim<- c("crnd-attribute:colno", "crnd-attribute:cellpartno", "crnd-dimension:trta" )
# idrow is a function of rowdim; writing it directly is easier for now
idrow<-  c( "aesocvalue", "aedecodvalue" )

# For demo table
rowdim<- c("crnd-attribute:rowno", "crnd-dimension:agegr1", "crnd-dimension:race", "crnd-dimension:ethnic", "crnd-dimension:sex" )
coldim<- c("crnd-attribute:colno", "crnd-attribute:cellpartno", "crnd-dimension:trt01a" )
idrow<-  c( "agegr1value", "racevalue", "ethnicvalue", "sexvalue" )

outhtmlfile<- MakeHTMLfromQb( store, forsparqlprefix, domainName, dimensions, rowdim, coldim, idrow, htmlfile=NULL )
outhtmlfile

```

# Session information
```{r, echo=TRUE}
sessionInfo()
```

