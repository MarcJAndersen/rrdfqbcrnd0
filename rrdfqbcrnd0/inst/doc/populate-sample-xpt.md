---
title: "Populate sample-xpt directory with example file in SAS transport xpt format"
author: "mja@statgroup.dk"
date: "2015-05-03"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Populate sample-xpt directory with example file in SAS transport xpt format}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---

# Populate sample-xpt with example file in SAS transport xpt format

This script creates the result and codelist for a simple AE table.
The script is currently written to be executed manually.

TODO(mja): automate execution of script

This script downloads example files from phuse script repository
(https://github.com/phuse-org/phuse-scripts) and stores the files in
the corresponding example directory.


```r
knitr::read_chunk("setup.R")
```

```r
devtools::load_all(pkg="../..")
```

```
## Loading rrdfqbcrnd0
## Loading required package: rrdf
## Loading required package: rrdflibs
## Loading required package: xlsx
## Loading required package: xlsxjars
## Loading required package: RCurl
## Loading required package: bitops
## 
## Attaching package: 'RCurl'
## 
## The following object is masked from 'package:rJava':
## 
##     clone
```

```
## Warning: character(0)
```



```r
repositoryURL<- "https://raw.githubusercontent.com/phuse-org/phuse-scripts/master/scriptathon2014/data"

fnadae<- file.path( system.file("extdata/sample-xpt", package="rrdfqbcrnd0"), "adae.xpt" )
message("Downloading to ", fnadae )
```

```
## Downloading to /home/ma/projects/R-packages/rrdfqbcrnd0/rrdfqbcrnd0/inst/extdata/sample-xpt/adae.xpt
```

```r
downloadURL<-paste0(repositoryURL, "/", "adae.xpt")
message("Downloading from ", downloadURL )
```

```
## Downloading from https://raw.githubusercontent.com/phuse-org/phuse-scripts/master/scriptathon2014/data/adae.xpt
```

```r
download.file( downloadURL, fnadae, method="curl")

fnadae<- file.path( system.file("extdata/sample-xpt", package="rrdfqbcrnd0"), "adsl.xpt" )
message("Downloading to ", fnadsl )
```

```
## Error in message("Downloading to ", fnadsl): object 'fnadsl' not found
```

```r
downloadURL<-paste0(repositoryURL, "/", "adsl.xpt")
message("Downloading from ", downloadURL )
```

```
## Downloading from https://raw.githubusercontent.com/phuse-org/phuse-scripts/master/scriptathon2014/data/adsl.xpt
```

```r
download.file( downloadURL, fnadsl, method="curl")
```

```
## Error in download.file(downloadURL, fnadsl, method = "curl"): object 'fnadsl' not found
```


```r
if (require(foreign)) {
fnadae<- system.file("extdata/sample-xpt", "adae.xpt", package="rrdfqbcrnd0")
message("Reading SAS transport file ", fnadae )
adae<-read.xport(fnadae)
str(adae)
fnadsl<- system.file("extdata/sample-xpt", "adsl.xpt", package="rrdfqbcrnd0")
message("Reading SAS transport file ", fnadsl )
adsl<-read.xport(fnadsl)
str(adsl)

## sasxport.get should create dataset with dates
## lookup.xport(fnadsl)
## adslX<- Hmisc::sasxport.get(fnadsl,format=lookup.xport(fnadsl))
## adslX<- Hmisc::sasxport.get(fnadsl,format=lookup.xport(testFile)$FORMAT)
## adslX<- Hmisc::sasxport.get(fnadsl,method="sas")
## names(adslX)
## str(adslX$trtsdt)

## this works as expected
## testFile <- system.file('extdata', 'test2.xpt', package="SASxport")
## w<-Hmisc::sasxport.get(testFile)
## str(w$test)

## looks like it is easier to do own data conversion
## str(head(Hmisc:::importConvertDateTime(adsl$TRTSDT, "date", "sas")))
}
```

```
## Loading required package: foreign
## Reading SAS transport file /home/ma/projects/R-packages/rrdfqbcrnd0/rrdfqbcrnd0/inst/extdata/sample-xpt/adae.xpt
```

'data.frame':	1191 obs. of  55 variables:
 $ STUDYID : Factor w/ 1 level "CDISCPILOT01": 1 1 1 1 1 1 1 1 1 1 ...
 $ SITEID  : Factor w/ 17 levels "701","702","703",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ USUBJID : Factor w/ 225 levels "01-701-1015",..: 1 1 1 2 2 2 2 3 3 4 ...
 $ TRTA    : Factor w/ 3 levels "Placebo","Xanomeline High Dose",..: 1 1 1 1 1 1 1 2 2 2 ...
 $ TRTAN   : num  0 0 0 0 0 0 0 81 81 81 ...
 $ AGE     : num  63 63 63 64 64 64 64 71 71 77 ...
 $ AGEGR1  : Factor w/ 3 levels "<65",">80","65-80": 1 1 1 1 1 1 1 3 3 3 ...
 $ AGEGR1N : num  1 1 1 1 1 1 1 2 2 2 ...
 $ RACE    : Factor w/ 3 levels "AMERICAN INDIAN OR ALASKA NATIVE",..: 3 3 3 3 3 3 3 3 3 3 ...
 $ RACEN   : num  1 1 1 1 1 1 1 1 1 1 ...
 $ SEX     : Factor w/ 2 levels "F","M": 1 1 1 2 2 2 2 2 2 1 ...
 $ SAFFL   : Factor w/ 1 level "Y": 1 1 1 1 1 1 1 1 1 1 ...
 $ TRTSDT  : num  19725 19725 19725 19210 19210 ...
 $ TRTEDT  : num  19906 19906 19906 19237 19237 ...
 $ ASTDT   : num  19726 19726 19732 19212 19212 ...
 $ ASTDTF  : Factor w/ 2 levels "","D": 1 1 1 1 1 1 1 1 1 1 ...
 $ ASTDY   : num  2 2 8 3 3 22 3 3 21 58 ...
 $ AENDT   : num  NA NA 19734 19235 NA ...
 $ AENDY   : num  NA NA 10 26 NA NA 26 NA NA NA ...
 $ ADURN   : num  NA NA 3 24 NA NA 24 NA NA NA ...
 $ ADURU   : Factor w/ 2 levels "","DAY": 1 1 2 2 1 1 2 1 1 1 ...
 $ AETERM  : Factor w/ 242 levels "ABDOMINAL DISCOMFORT",..: 16 21 85 102 102 34 102 16 21 21 ...
 $ AELLT   : Factor w/ 326 levels "ABDOMINAL CRAMPS",..: 32 26 97 112 200 41 112 23 26 26 ...
 $ AELLTCD : num  NA NA NA NA NA NA NA NA NA NA ...
 $ AEDECOD : Factor w/ 242 levels "ABDOMINAL DISCOMFORT",..: 16 21 85 102 102 34 102 16 21 21 ...
 $ AEPTCD  : num  NA NA NA NA NA NA NA NA NA NA ...
 $ AEHLT   : Factor w/ 242 levels "HLT_0003","HLT_0005",..: 191 99 48 89 89 125 89 191 99 99 ...
 $ AEHLTCD : num  NA NA NA NA NA NA NA NA NA NA ...
 $ AEHLGT  : Factor w/ 242 levels "HLGT_0004","HLGT_0005",..: 44 111 187 60 60 24 60 44 111 111 ...
 $ AEHLGTCD: num  NA NA NA NA NA NA NA NA NA NA ...
 $ AEBODSYS: Factor w/ 23 levels "CARDIAC DISORDERS",..: 6 6 5 20 20 1 20 6 6 6 ...
 $ AESOC   : Factor w/ 23 levels "CARDIAC DISORDERS",..: 6 6 5 20 20 1 20 6 6 6 ...
 $ AESOCCD : num  NA NA NA NA NA NA NA NA NA NA ...
 $ AESEV   : Factor w/ 3 levels "MILD","MODERATE",..: 1 1 1 1 2 1 1 1 1 1 ...
 $ AESER   : Factor w/ 2 levels "N","Y": 1 1 1 1 1 1 1 1 1 1 ...
 $ AESCAN  : Factor w/ 2 levels "N","Y": 1 1 1 1 1 1 1 1 1 1 ...
 $ AESCONG : Factor w/ 1 level "N": 1 1 1 1 1 1 1 1 1 1 ...
 $ AESDISAB: Factor w/ 2 levels "N","Y": 1 1 1 1 1 1 1 1 1 1 ...
 $ AESDTH  : Factor w/ 2 levels "N","Y": 1 1 1 1 1 1 1 1 1 1 ...
 $ AESHOSP : Factor w/ 2 levels "N","Y": 1 1 1 1 1 1 1 1 1 1 ...
 $ AESLIFE : Factor w/ 2 levels "N","Y": 1 1 1 1 1 1 1 1 1 1 ...
 $ AESOD   : Factor w/ 1 level "N": 1 1 1 1 1 1 1 1 1 1 ...
 $ AEREL   : Factor w/ 5 levels "","NONE","POSSIBLE",..: 4 4 5 3 4 3 3 3 4 4 ...
 $ AEACN   : Factor w/ 1 level "": 1 1 1 1 1 1 1 1 1 1 ...
 $ AEOUT   : Factor w/ 3 levels "FATAL","NOT RECOVERED/NOT RESOLVED",..: 2 2 3 2 2 2 3 2 2 2 ...
 $ AESEQ   : num  1 2 3 1 2 3 4 1 2 1 ...
 $ TRTEMFL : Factor w/ 2 levels "N","Y": 2 2 2 2 2 2 2 2 2 2 ...
 $ AOCCFL  : Factor w/ 2 levels "","Y": 2 1 1 2 1 1 1 2 1 2 ...
 $ AOCCSFL : Factor w/ 2 levels "","Y": 2 1 2 2 1 2 1 2 1 2 ...
 $ AOCCPFL : Factor w/ 2 levels "","Y": 2 2 2 2 1 2 1 2 2 2 ...
 $ AOCC02FL: Factor w/ 2 levels "","Y": 1 1 1 1 1 1 1 1 1 1 ...
 $ AOCC03FL: Factor w/ 2 levels "","Y": 1 1 1 1 1 1 1 1 1 1 ...
 $ AOCC04FL: Factor w/ 2 levels "","Y": 1 1 1 1 1 1 1 1 1 1 ...
 $ CQ01NAM : Factor w/ 2 levels "","DERMATOLOGIC EVENTS": 2 2 1 2 2 1 2 2 2 2 ...
 $ AOCC01FL: Factor w/ 2 levels "","Y": 2 1 1 2 1 1 1 2 1 2 ...

```
## Reading SAS transport file /home/ma/projects/R-packages/rrdfqbcrnd0/rrdfqbcrnd0/inst/extdata/sample-xpt/adsl.xpt
```

'data.frame':	254 obs. of  48 variables:
 $ STUDYID : Factor w/ 1 level "CDISCPILOT01": 1 1 1 1 1 1 1 1 1 1 ...
 $ USUBJID : Factor w/ 254 levels "01-701-1015",..: 1 2 3 4 5 6 7 8 9 10 ...
 $ SUBJID  : Factor w/ 254 levels "1001","1002",..: 10 16 21 26 27 36 64 74 76 77 ...
 $ SITEID  : Factor w/ 17 levels "701","702","703",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ SITEGR1 : Factor w/ 11 levels "701","703","704",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ ARM     : Factor w/ 3 levels "Placebo","Xanomeline High Dose",..: 1 1 2 3 2 1 3 3 3 1 ...
 $ TRT01P  : Factor w/ 3 levels "Placebo","Xanomeline High Dose",..: 1 1 2 3 2 1 3 3 3 1 ...
 $ TRT01PN : num  0 0 81 54 81 0 54 54 54 0 ...
 $ TRT01A  : Factor w/ 3 levels "Placebo","Xanomeline High Dose",..: 1 1 2 3 2 1 3 3 3 1 ...
 $ TRT01AN : num  0 0 81 54 81 0 54 54 54 0 ...
 $ TRTSDT  : num  19725 19210 19558 19800 19905 ...
 $ TRTEDT  : num  19906 19237 19737 19813 20087 ...
 $ TRTDUR  : num  182 28 180 14 183 26 190 10 55 182 ...
 $ AVGDD   : num  0 0 77.7 54 76.9 0 54 54 54 0 ...
 $ CUMDOSE : num  0 0 13986 756 14067 ...
 $ AGE     : num  63 64 71 74 77 85 68 81 84 52 ...
 $ AGEGR1  : Factor w/ 3 levels "<65",">80","65-80": 1 1 3 3 3 2 3 2 2 1 ...
 $ AGEGR1N : num  1 1 2 2 2 3 2 3 3 1 ...
 $ AGEU    : Factor w/ 1 level "YEARS": 1 1 1 1 1 1 1 1 1 1 ...
 $ RACE    : Factor w/ 3 levels "AMERICAN INDIAN OR ALASKA NATIVE",..: 3 3 3 3 3 3 3 3 3 3 ...
 $ RACEN   : num  1 1 1 1 1 1 1 1 1 1 ...
 $ SEX     : Factor w/ 2 levels "F","M": 1 2 2 2 1 1 2 1 2 2 ...
 $ ETHNIC  : Factor w/ 2 levels "HISPANIC OR LATINO",..: 1 1 2 2 2 2 2 2 2 2 ...
 $ SAFFL   : Factor w/ 1 level "Y": 1 1 1 1 1 1 1 1 1 1 ...
 $ ITTFL   : Factor w/ 1 level "Y": 1 1 1 1 1 1 1 1 1 1 ...
 $ EFFFL   : Factor w/ 2 levels "N","Y": 2 2 2 2 2 2 2 2 2 2 ...
 $ COMP8FL : Factor w/ 2 levels "N","Y": 2 1 2 1 2 1 2 1 2 2 ...
 $ COMP16FL: Factor w/ 2 levels "N","Y": 2 1 2 1 2 1 2 1 1 2 ...
 $ COMP24FL: Factor w/ 2 levels "N","Y": 2 1 2 1 2 1 2 1 1 2 ...
 $ DISCONFL: Factor w/ 2 levels "","Y": 1 2 1 2 1 2 1 2 2 1 ...
 $ DSRAEFL : Factor w/ 2 levels "","Y": 1 2 1 1 1 2 1 2 2 1 ...
 $ DTHFL   : Factor w/ 2 levels "","Y": 1 1 1 1 1 1 1 1 1 1 ...
 $ BMIBL   : num  25.1 30.4 31.4 28.8 26.1 30.4 27.3 23.9 23.9 21.9 ...
 $ BMIBLGR1: Factor w/ 3 levels "<25",">=30","25-<30": 3 2 2 3 3 2 3 1 1 1 ...
 $ HEIGHTBL: num  147 163 178 175 155 ...
 $ WEIGHTBL: num  54.4 80.3 99.3 88.5 62.6 67.1 78 59.9 78.9 71.2 ...
 $ EDUCLVL : num  16 14 16 12 9 8 18 22 12 14 ...
 $ DISONSDT: num  18382 16871 18247 18111 18899 ...
 $ DURDIS  : num  43.9 76.4 42.8 55.3 32.9 ...
 $ DURDSGR1: Factor w/ 2 levels "<12",">=12": 2 2 2 2 2 2 2 2 2 2 ...
 $ VISIT1DT: num  19718 19196 19550 19792 19898 ...
 $ RFSTDTC : Factor w/ 205 levels "2012-07-09","2012-07-20",..: 171 6 113 192 204 61 170 9 31 190 ...
 $ RFENDTC : Factor w/ 211 levels "2012-09-01","2012-09-02",..: 188 2 136 167 210 39 189 3 16 200 ...
 $ VISNUMEN: num  12 5 12 5 12 6 12 4 8 12 ...
 $ RFENDT  : num  19906 19238 19737 19827 20087 ...
 $ DCDECOD : Factor w/ 9 levels "ADVERSE EVENT",..: 2 1 2 8 2 1 2 1 1 2 ...
 $ DCREASCD: Factor w/ 10 levels "Adverse Event",..: 2 1 2 9 2 1 2 1 1 2 ...
 $ MMSETOT : num  23 23 23 23 21 23 10 23 20 20 ...


```r
if (require(SASxport)) {

fnadsl<- system.file("extdata/sample-xpt", "adsl.xpt", package="rrdfqbcrnd0")
message("Reading SAS transport file ", fnadsl, include.formats=TRUE )
print(SASxport::lookup.xport(fnadsl))
adsl<-SASxport::read.xport(fnadsl, include.formats=TRUE,verbose=TRUE)
str(adsl)
## do not understand why this is not a date
## running the example for SASxport::read.xport
## testFile <- system.file('extdata', 'test2.xpt', package="SASxport")
## w <- read.xport(testFile)
## class(w)
## sapply(w, head)
## shows SAS date times are imported as DATETIME
## w$TEST$DT1
## but SAS date are not imported
## w$TEST$D1
str(adsl$ADSL$TRTSDT)

fnadae<- system.file("extdata/sample-xpt", "adae.xpt", package="rrdfqbcrnd0")
message("Reading SAS transport file ", fnadae )
print(SASxport::lookup.xport(fnadae))
adae<-SASxport::read.xport(fnadae, include.formats=TRUE)
str(adae)

}
```

TODO(mja): move the example data into a separate package.
