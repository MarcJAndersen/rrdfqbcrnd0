---
title: "Usage of cube DEMO"
author: "mja@statgroup.dk"
date: "2015-06-28"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Usage of cube DEMO}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---

# Introduction

This is not a good example yet.
TODO(mja): fix it.

# Create DEMO sample table from CSV file

This script creates the result and codelist for a simple DEMO table.


```r
library(rrdfqbcrnd0)
```

```
## Error in library(rrdfqbcrnd0): there is no package called 'rrdfqbcrnd0'
```

```r
dataCubeSpec<- system.file("extdata/CUBE-standards-rdf", "cube.ttl", package="rrdfqbcrnd0")

dataCubeFile<- system.file("extdata/sample-rdf", "DC-DEMO-sample.ttl", package="rrdfqbcrnd0")

store <- new.rdf()  # Initialize
```

```
## Error in eval(expr, envir, enclos): could not find function "new.rdf"
```

```r
cat("Loading cube specfication from ", dataCubeSpec, "\n")
```

```
## Loading cube specfication from
```

```r
load.rdf(dataCubeSpec, format="TURTLE", appendTo= store)
```

```
## Error in eval(expr, envir, enclos): could not find function "load.rdf"
```

```r
cat("Loading cube from ", dataCubeFile, "\n")
```

```
## Loading cube from
```

```r
load.rdf(dataCubeFile, format="TURTLE", appendTo= store)
```

```
## Error in eval(expr, envir, enclos): could not find function "load.rdf"
```

```r
summarize.rdf(store)
```

```
## Error in eval(expr, envir, enclos): could not find function "summarize.rdf"
```


## This works do not change


```r
dsdName<- GetDsdNameFromCube( store )
```

```
## Error in eval(expr, envir, enclos): could not find function "GetDsdNameFromCube"
```

```r
domainName<- GetDomainNameFromCube( store )
```

```
## Error in eval(expr, envir, enclos): could not find function "GetDomainNameFromCube"
```

```r
cat("dsdName ", dsdName, ", domainName ", domainName, "\n" )
```

```
## Error in cat("dsdName ", dsdName, ", domainName ", domainName, "\n"): object 'dsdName' not found
```

```r
forsparqlprefix<- GetForSparqlPrefix( domainName )
```

```
## Error in eval(expr, envir, enclos): could not find function "GetForSparqlPrefix"
```

```r
cat(forsparqlprefix,"\n")
```

```
## Error in cat(forsparqlprefix, "\n"): object 'forsparqlprefix' not found
```

```r
rq<-  paste( forsparqlprefix,
'
select *
where { 
?s a qb:Observation ; 
?p ?o ;
.
[] qb:dimension ?p .
values (?s) {
(ds:obs114)
}
}
# limit 30
',
"\n"                               
)
```

```
## Error in paste(forsparqlprefix, "\nselect *\nwhere { \n?s a qb:Observation ; \n?p ?o ;\n.\n[] qb:dimension ?p .\nvalues (?s) {\n(ds:obs114)\n}\n}\n# limit 30\n", : object 'forsparqlprefix' not found
```

```r
cube.observations<- sparql.rdf(store, rq)
```

```
## Error in eval(expr, envir, enclos): could not find function "sparql.rdf"
```

```r
knitr::kable(cube.observations)
```

```
## Error in is.data.frame(x): object 'cube.observations' not found
```

## Getting triples with information of object if literal



```r
cons.rq<-  paste( forsparqlprefix,
'
construct { ?s ?p ?o }
where { 
?s ?p ?o .
BIND( datatype(?o) as ?datatype )
BIND( isLiteral(?o) as ?isLiteral )
BIND( lang(?o) as ?lang )
values (?s) {
(ds:obs114)
}
}
',
"\n"                               
)
```

```
## Error in paste(forsparqlprefix, "\nconstruct { ?s ?p ?o }\nwhere { \n?s ?p ?o .\nBIND( datatype(?o) as ?datatype )\nBIND( isLiteral(?o) as ?isLiteral )\nBIND( lang(?o) as ?lang )\nvalues (?s) {\n(ds:obs114)\n}\n}\n", : object 'forsparqlprefix' not found
```

```r
save.rdf(construct.rdf( store, cons.rq) , file.path(tempdir(), "rapperin.ttl"), "TURTLE")
```

```
## Error in eval(expr, envir, enclos): could not find function "save.rdf"
```

To see dot code generated by rapper:
```
rapper -i turtle -o dot /tmp/Rtmpcccgdg/rapperin.ttl
```

To display the dot code
```
rapper -i turtle -o dot /tmp/Rtmpcccgdg/rapperin.ttl | dot -x -Tpdf -ograph.pdf
```

See also (http://www.bioconductor.org/packages/release/bioc/vignettes/Rgraphviz/inst/doc/Rgraphviz.pdf) for Rgraphviz package - may be used to display graphs.



```r
rq<-  paste( forsparqlprefix,
'
select *
where { 
?s ?p ?o .
BIND( datatype(?o) as ?datatype )
BIND( isLiteral(?o) as ?isLiteral )
BIND( lang(?o) as ?lang )
values (?s) {
(ds:obs114)
}
}
',
"\n"                               
)
```

```
## Error in paste(forsparqlprefix, "\nselect *\nwhere { \n?s ?p ?o .\nBIND( datatype(?o) as ?datatype )\nBIND( isLiteral(?o) as ?isLiteral )\nBIND( lang(?o) as ?lang )\nvalues (?s) {\n(ds:obs114)\n}\n}\n", : object 'forsparqlprefix' not found
```

```r
res<- sparql.rdf(store, rq)
```

```
## Error in eval(expr, envir, enclos): could not find function "sparql.rdf"
```

```r
knitr::kable(cube.observations)
```

```
## Error in is.data.frame(x): object 'cube.observations' not found
```

```r
dimnames(res)
```

```
## Error in eval(expr, envir, enclos): object 'res' not found
```

```r
allIRI<- c( res[,1],res[,2])
```

```
## Error in eval(expr, envir, enclos): object 'res' not found
```

```r
uallIRI<- unique(allIRI)
```

```
## Error in unique(allIRI): object 'allIRI' not found
```

```r
L<- list()
for (i in 1:length(uallIRI) ) {
L[[ uallIRI[i] ]] <- paste( "L", i, sep="" )
}
```

```
## Error in eval(expr, envir, enclos): object 'uallIRI' not found
```

```r
paste( L[[ res[,1] ]], L[[ res[,2] ]], res[,3] )
```

```
## Error in paste(L[[res[, 1]]], L[[res[, 2]]], res[, 3]): object 'res' not found
```

### Check the statistics


```r
stmtSQL<- GetSQLFromCube(store) 
```

```
## Error in eval(expr, envir, enclos): could not find function "GetSQLFromCube"
```

```r
cat(stmtSQL$summStatSQL) 
```

```
## Error in cat(stmtSQL$summStatSQL): object 'stmtSQL' not found
```
