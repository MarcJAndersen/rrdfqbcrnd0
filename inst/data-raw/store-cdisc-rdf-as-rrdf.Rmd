---
title: "Store CDISC RDF as RRDF data model"
author: "PhuseSubTeamAnalysisResults@example.org"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Store CDISC RDF as RRDF data model}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---


## Prelimnaries
write more here

## Download the CDISC standards in RDF

The code below assumes that the CDISC standards in RDF are downloaded to the directory ~/projects/phrmwg.

```
cd ~/projects/phrmwg
git clone https://github.com/phuse-org/rdf.cdisc.org.git
```

## Finding the files

Finding the files replace directory for find with the appropriate directory for your setup.
Also change below in R code.

```
find ~/projects/phrmwg/rdf.cdisc.org -name "*.rdf" -o -name "*.owl" -o -name "*.ttl"
```

## Create dataset with files to import



```{r, results='asis', eval=TRUE}

CDISCfilelist<- c( "rdf.cdisc.org/resources/w3.org/skos.rdf", 
"rdf.cdisc.org/resources/dublincore.org/dcam.rdf", 
"rdf.cdisc.org/resources/dublincore.org/dcelements.rdf", 
"rdf.cdisc.org/resources/dublincore.org/dcterms.rdf", 
"rdf.cdisc.org/terminology-2013-06-28/glossary-terminology.owl", 
"rdf.cdisc.org/terminology-2013-06-28/cdash-terminology.owl", 
"rdf.cdisc.org/terminology-2013-06-28/sdtm-terminology.owl", 
"rdf.cdisc.org/terminology-2013-06-28/qs-terminology.owl", 
"rdf.cdisc.org/terminology-2013-06-28/send-terminology.owl", 
"rdf.cdisc.org/terminology-2013-06-28/adam-terminology.owl", 
"rdf.cdisc.org/std/sdtm-1-2.ttl",
"rdf.cdisc.org/std/all-standards.ttl",
"rdf.cdisc.org/std/cdash-1-1.ttl",
"rdf.cdisc.org/std/sdtmig-3-1-3.ttl",
"rdf.cdisc.org/std/sdtmig-3-1-2.ttl",
"rdf.cdisc.org/std/adamig-1-0.ttl",
"rdf.cdisc.org/std/sendig-3-0.ttl",
"rdf.cdisc.org/std/sdtm-1-3.ttl",
"rdf.cdisc.org/std/adam-2-1.ttl", 
"rdf.cdisc.org/schemas/ct-schema.owl", 
"rdf.cdisc.org/schemas/meta-model-schema.owl", 
"rdf.cdisc.org/schemas/cdisc-schema.owl"
                  )

format.from.ext<- list("ttl"="TURTLE", "rdf"="RDF/XML", "owl"="RDF/XML", "n3"="N3")

```

### Create local version using RRDF from local directory conting rdf.cdisc.org

First load the files in a rrdf store.

```{r, results='asis', eval=TRUE}

library(rrdf)
library(tools)

cdisc.rdf <- new.rdf(ontology=FALSE)
# change as appropriate
# in my setup the phrmwg directory contains a git pull of rdf.cdisc.org
cdisc.files.dir<- "/home/ma/projects/phrmwg/"

for (fn in CDISCfilelist) {
  cat(paste0("Loading ", fn, " ..", sep=""))
  load.rdf(paste0(cdisc.files.dir, fn, sep=""), format=format.from.ext[[ file_ext(fn) ]], appendTo=cdisc.rdf )
  cat(" done\n",sep="");
}

cat("Stored rdf.cdisc.org: ", summarize.rdf(cdisc.rdf),"\n")

cdisc.save.ttl<- "cdisc-rdf.ttl"
cdisc.out <- save.rdf(cdisc.rdf, filename=cdisc.save.ttl, format="TURTLE")
cdisc.save.zip<- paste0(file_path_sans_ext(cdisc.save.ttl),".zip",sep="")
zip( cdisc.save.zip, files=c(cdisc.save.ttl) )

```

```{r, results='asis', eval=TRUE}

cdisc.test.rdf = new.rdf(ontology=FALSE)
unzip( cdisc.save.zip, files=c(cdisc.save.ttl) )
load.rdf(cdisc.save.ttl, format="TURTLE", appendTo=cdisc.test.rdf )

cat("Loaded rdf.cdisc.org: ", summarize.rdf(cdisc.test.rdf),"\n")

# need more code to compare the two models ...

```


### Create local version using SPARQL

The code below does not work.

```{r, results='asis', eval=FALSE}

library (rrdf)
# library (RCurl)

# change as appropriate

URLstem<- "https://github.com/phuse-org/rdf.cdisc.org/raw/master"

cdisc.rdf.store = new.rdf(ontology=FALSE)
results = construct.rdf(cdisc.rdf.store, paste(
  "CONSTRUCT { ?s ?p ?o }",
  "FROM <https://github.com/phuse-org/rdf.cdisc.org/raw/master/schemas/cdisc-schema.owl>",
  "FROM <https://github.com/phuse-org/rdf.cdisc.org/raw/master/schemas/meta-model-schema.owl>", 
  "FROM <https://github.com/phuse-org/rdf.cdisc.org/raw/master/schemas/cdisc-schema.owl>",
  "WHERE { ?s ?p ?o }"
))
str(results)
print(results)

```
