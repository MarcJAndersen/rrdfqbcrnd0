---
title: "Data qubes from Workbook"
author: "PhuseSubTeamAnalysisResults@example.org"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Data qubes from Workbookle}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---


### How to run from command prompt when developing

Start in the package root directory

Devtools should reply reply Loading rrdfqbcrnd0.

The knit command should generate .md file in the present work directory - the package root directory


```{r, eval=FALSE}
library(devtools)
devtools::load_all()

library(knitr)
knit("vignettes/qube-from-workbook.Rmd")
```

Generate the pdf file using the following command
```{r makepdf.sh, eval=FALSE, engine='bash'}
pandoc qube-from-workbook.md -o xx.pdf
```

The knitr::knit2html should generate a .html file in the present work directory - the package root directory

Generating HTML works nicely
```{r, eval=FALSE} 
knitr::knit2html("vignettes/qube-from-workbook.Rmd")
```

The following does not work as the texi2dvi can not handle the dollar signs in the bash code above.
I suppose some other options have to be given. The work around is to use pandoc on the .md file generated as mentioned above.

```{r, eval=FALSE}
knitr::knit2pdf("vignettes/qube-from-workbook.Rmd")
```

## Code


```{r, eval=TRUE}

library (rrdf)
library (xlsx)
library(rrdfqbcrnd0)



# NOTE: if all cells in a column is missing, then the input fails
RDFCubeWorkbook<- system.file("extdata/sample-cfg", "RDFCubeWorkbook.xlsx", package="rrdfqbcrnd0")

dm.cube.fn<- BuildCubeFromWorkbook(RDFCubeWorkbook, "DM" )

ae.cube.fn<- BuildCubeFromWorkbook(RDFCubeWorkbook, "AE" )


```


Now look at the generated cubes. Note: by specifying prefix the output contains is shown using the prefixes.
Note for future: This may be a disadvantage if the value of the prefix, say ds, changes.

```{r, echo=FALSE, results='asis'}

domainName<- "DM"
dataCubeFile<- dm.cube.fn

checkCube <- new.rdf(ontology=FALSE)  # Initialize

load.rdf(dataCubeFile, format="TURTLE", appendTo= checkCube)
summarize.rdf(checkCube)


## ------------------------------------------------------------------------

data(qbCDISCprefixes)
common.prefixes <- data.frame(
    prefix=gsub("^prefix","",names(qbCDISCprefixes)),
    namespace=as.character(qbCDISCprefixes )
    )
custom.prefixes <-Get.qb.crnd.prefixes(tolower(domainName))

forsparqlprefix<- Get.rq.prefix.df(rbind(common.prefixes, custom.prefixes))

cube.observations1.rq<- paste( forsparqlprefix,
'
select *
where {?s ?p ?o .}
limit 10
',
"\n"
)

cube.observations1<- sparql.rdf(checkCube, cube.observations1.rq  )
knitr::kable(head(cube.observations1, 10))

cube.observations2.rq<-  paste( forsparqlprefix,
'
select *
where { ?s a qb:Observation ; ?p ?o .}
',
"\n"                               
)

cube.observations2<- sparql.rdf(checkCube, cube.observations2.rq)
knitr::kable(head(cube.observations2, 10))

```
